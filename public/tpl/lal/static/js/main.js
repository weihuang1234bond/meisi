(function(e){var t=function(){var e={};return function(t){e.send=function(e){window._stat_request=new Image,_stat_request.src="http://dd.browser.msvodx.com/static/a/"+e+(e.indexOf("?")>-1?"&":"?")+ +(new Date)+Math.random().toString().replace("0.","").substr(0,10)}}(e),e}(),n={init:function(){this.toutiao(),this.eventManager(),this.lazyload(),this.extendDetect(),this.hotList(),this.concerned()},toutiao:function(){function g(t,r,i,s){var o;a.show();if(t=="huya")var o='<embed width="100%" height="100%" wmode="transparent" allownetworking="all" allowscriptaccess="always" Flashvars="rso=360tv" src="'+r+'" quality="high" bgcolor="#000" wmode="window" allowfullscreen="true" allowFullScreenInteractive="true" type="application/x-shockwave-flash">';else if(t=="douyu")E(r);else if(t=="panda")var o='<embed width="100%" height="100%" wmode="transparent" allownetworking="all" allowscriptaccess="always" src="'+r+'" quality="high" bgcolor="#000" wmode="window" allowfullscreen="true" allowFullScreenInteractive="true" type="application/x-shockwave-flash">';else if(t=="chushou")var o='<embed width="100%" height="100%" wmode="transparent" allownetworking="all" allowscriptaccess="always" src="'+r+'" quality="high" bgcolor="#000" wmode="window" allowfullscreen="true" allowfullscreeninteractive="true" type="application/x-shockwave-flash">';else var o='<object id="player" name="player" width="100%" height="100%" type="application/x-shockwave-flash" data="http://s4.qhres.com/static/2ed0571960ccf152.swf" style="visibility: visible;"><param name="menu" value="false"><param name="allowscriptaccess" value="always"><param name="bgcolor" value="#000000"><param name="wmode" value="transparent"><param name="allowFullScreen" value="true"><param name="page" value="live"><param name="flashvars" value="'+r+'">'+"</object>"+'<a href="'+i+'" data-url="'+i+'" class="go-live">进入直播间</a>';n.html(o),clearInterval(u);var u=setTimeout(function(){a.fadeOut("slow")},1500);e.ajax({url:"/stat/loopView",type:"POST",data:{show_url:i}}).done(function(e){})}function y(t,n,r,i){var s="",o=0,a=0,l=0;o=Math.floor(t/3600),a=Math.floor(t%3600/60),l=Math.floor(t%3600%60),s=(o<10?"0"+o:o)+":"+(a<10?"0"+a:a)+":"+(l<10?"0"+l:l);var c={url:f+"/"+n,guid:d.guid,duration:s,position:parseInt(r)+1,id:n};e.ajax({url:"/stat/loopDuration",type:"POST",async:!1,data:c}).done(function(e){}),u=i}function b(){v=setInterval(w,m)}function w(){var e=Math.ceil((new Date).getTime()/1e3),n=e-c,r=t.find(".active").index(),i=t.find(".active").data("id");y(n,i,r,i)}function E(e){var t='<div id="douyuPlay"></div>';n.html(t);var r=e,i="100%",s="100%",o="11.1.0",u="",a={},f={};f.quality="high",f.bgcolor="#000000",f.allowscriptaccess="always",f.allowfullscreen="true",f.allowFullScreenInteractive="true",f.wmode="transparent";var l={};l.id="WebRoom",l.name="WebRoom",l.align="middle",swfobject.embedSWF(r,"douyuPlay",i,s,o,u,a,f,l),swfobject.createCSS("#douyuPlay","display:block;text-align:left;")}var t=e(".toutiao"),n=e(".toutiao-player"),r=e(".toutiao-switch a"),i=t.find(".active").data("src"),s=t.find(".active").data("play"),o=t.find(".active").data("url"),u=t.find(".active").data("id"),a=t.find(".toutiao-load"),f=window.location.origin,l=Math.ceil((new Date).getTime()/1e3),c=Math.ceil((new Date).getTime()/1e3),h=t.find(".active").index(),p=t.find(".active").index(),d=monitor.data.getBase(),v,m=3e5;g(i,s,o),b(),r.on("click",function(n){n.preventDefault(),p=t.find(".active").index();if(!e(this).hasClass("active")){e(this).addClass("active").siblings("a").removeClass("active");var r=e(this).data("src"),i=e(this).data("play"),s=e(this).data("url"),o=e(this).data("id"),a=Math.ceil((new Date).getTime()/1e3),f=Math.ceil((new Date).getTime()/1e3),c=a-l;h=t.find(".active").index(),clearInterval(v),b(),g(r,i,s),y(c,u,p,o),l=Math.ceil((new Date).getTime()/1e3)}}),window.onbeforeunload=function(e){var n=Math.ceil((new Date).getTime()/1e3),r=n-l;p=t.find(".active").index(),y(r,u,p)},n.hover(function(){e(".go-live").fadeIn()},function(){e(".go-live").fadeOut()})},switchable:function(){e(".switchable").switchable({effect:"scroll",loop:!0,autoplay:!0,interval:3e3,onSwitch:function(t){var n=t.currentTarget.index,r=e(".switchable .panels li").eq(n).html();e(".go-live").attr("href",e(r).attr("href"))}}),e(".switchable div").hover(function(){e(".go-live").fadeIn()},function(){e(".go-live").fadeOut()})},eventManager:function(){e(".trailer-list li").hover(function(){e(this).addClass("cur"),e(this).siblings("li").removeClass("cur")},function(){e(this).removeClass("cur")}),e(".rank-hd li").on("mouseover",function(){var t=e(this).index(),n=e(this).parents(".rank"),r=n.find(".rank-list ul");e(this).addClass("cur").siblings("li").removeClass("cur"),r.eq(t).removeClass("hide").siblings(".rank-list ul").addClass("hide")})},lazyload:function(){e("img").lazyload({effect:"fadeIn",threshold:500,failure_limit:45})},extendDetect:function(){var t,n=navigator.userAgent;if(n.indexOf("Chrome")>0){var r=!1;window.addEventListener("message",i);function i(e){t=e.data,t=="beenInstalled"&&(r=!0)}setTimeout(function(){r==1?(e(".my-live-list").show().siblings("div").hide(),e(".history-list").show().siblings("div").hide()):e(".install-ext").show().siblings("div").hide()},200)}else e(".install-se").show().siblings("div").hide()},hotList:function(){function u(){i.find("li").fadeOut(300).end().find(".li-"+n).fadeIn(300),n++,n>=r&&(s.hide(),setTimeout(function(){o.fadeIn(600)},1e3))}var t=this,n=1,r=4,i=e(".my-live-lists ul"),s=e(".my-live .change"),o=e(".my-live .more");i.find("li").each(function(t){e(this).addClass("li-"+Math.floor(t/5))}),s.on("click",function(t){t.preventDefault(),e(".icon-change").rotate({angle:0,animateTo:360}),u(),i.find("img").lazyload({effect:"fadeIn",threshold:500,failure_limit:45})})},concerned:function(){var t=e(".concerned");t.on("click",function(t){t.preventDefault();var n=e(this),r=n.data("hostid");QHPass.getUserInfo(function(t){e.ajax({url:"/user/follow",type:"POST",data:{follow:r}}).done(function(e){e.errno==0&&(n.parents("li").append('<span class="has-concerned">已关注</span>'),n.remove(),window.postMessage({hostFollow:"hostFollow",hostId:r},window.location.origin))})},function(){QHPass.signIn(function(){window.location.href=window.location.href})})})}};n.init()})(jQuery);